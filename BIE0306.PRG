SAVE SCRE TO WSCRE99
store .t. to viendo
do while viendo
   STORE .F. TO WFLAGEXIT
   RESTORE SCRE FROM WSCRE99
   STORE SPACE(3)      TO XGEOGRU
   STORE SPACE(3)      TO XGEOSUB
   STORE SPACE(3)      TO XGEOREN
   STORE 0             TO WTOTAL
   STORE 100           TO WLINEA
   STORE 0             TO WPAGINA

   @ 04,0 clear to 09,60
   @ 04,0 to 09,60
   @ 04,02 SAY "BIENES POR UBICACION GEOGRAFICA"
   @ 05,01 say "GR. GEOGRAF.:"
   @ 06,01 say "SG. GEOGRAF.:"
   @ 07,01 say "RG. GEOGRAF.:"
   @ 08,01 say "SALIDA (M/I):"

   @ 05,14 GET XGEOGRU
   READ
   IF READKEY()=12 .OR. READKEY()=268
      SELECT 7
      SET ORDER TO 1
      EXIT
   ENDIF
   IF XGEOGRU <> SPACE(3)
      STORE XGEOGRU+"000000" TO XCLAVEGRU
      SELECT 3
      FIND &XCLAVEGRU
      IF EOF()
         STORE "NO REG.COMO GRUPO GEO." TO XGEOGRUDES
      ELSE
         STORE DESCRI                   TO XGEOGRUDES
      ENDIF
      @ 05,30 SAY XGEOGRUDES
      @ 06,14 GET XGEOSUB
      READ
      IF READKEY()=12 .OR. READKEY()=268
         LOOP
      ENDIF
      IF XGEOSUB <> SPACE(3)
         STORE XGEOGRU+XGEOSUB+"000"  TO XCLAVESUB
         SELECT 3
         FIND &XCLAVESUB
         IF EOF()
            STORE "NO REG.COMO SUBGR.GEO." TO XGEOSUBDES
         ELSE
            STORE DESCRI                   TO XGEOSUBDES
         ENDIF
         @ 06,30 SAY XGEOSUBDES
         @ 07,14 GET XGEOREN
         READ
         IF READKEY()=12 .OR. READKEY()=268
            LOOP
         ENDIF
         IF XGEOREN <> SPACE(3)
            STORE XGEOGRU+XGEOSUB+XGEOREN TO XCLAVEREN
            SELECT 3
            FIND &XCLAVEREN
            IF EOF()
               STORE "NO REG.COMO RENGLON GEO." TO XGEORENDES
            ELSE
               STORE DESCRI                     TO XGEORENDES
            ENDIF
         ELSE
            STORE "TODOS LOS RENGLONES"         TO XGEORENDES
         ENDIF
         @ 07,30 SAY XGEORENDES
      ELSE
         STORE "TODOS LOS SUBGRUPOS" TO XGEOSUBDES
         STORE "TODOS LOS RENGLONES" TO XGEORENDES
         @ 06,30 SAY XGEOSUBDES
         @ 07,30 SAY XGEORENDES
      ENDIF
   ELSE
      STORE "TODOS LOS GRUPOS"    TO XGEOGRUDES
      STORE "TODOS LOS SUBGRUPOS" TO XGEOSUBDES
      STORE "TODOS LOS RENGLONES" TO XGEORENDES
      @ 05,30 SAY XGEOGRUDES
      @ 06,30 SAY XGEOSUBDES
      @ 07,30 SAY XGEORENDES
   ENDIF

   STORE "SELECCIONE LA SALIDA: (M)ONITOR, (I)MPRESORA" TO TEX
   STORE "MI" TO WCH
   DO PREGUNTA
   IF READKEY()=12 .OR. READKEY()=268
      LOOP
   ENDIF
   STORE WCH TO WSALIDA
   STORE 0   TO WPAGINA
   STORE 100 TO WLINEA
   IF WSALIDA = "I"
      STORE 55 TO WSALTO
      STORE "IMPRESORA" TO WSALIDES
   ELSE
      STORE 22 TO WSALTO
      STORE "MONITOR" TO WSALIDES
   ENDIF
   @ 08,14 SAY WSALIDA
   @ 08,30 SAY WSALIDES

   STORE "OPCIONES: (C)ONTINUAR, (S)ALIR" TO TEX
   STORE "CS" TO WCH
   DO PREGUNTA
   IF WCH = "S"
      exit
   ENDIF
   IF WSALIDA = "I"
      SET DEVI TO PRINT
   ELSE
      SET DEVI TO SCRE
   ENDIF

   SELECT 7
   SET ORDER TO 4
   GO TOP
   DO WHILE .NOT. EOF()
      *** FILTROS
      IF EGRGRU<>SPACE(3) .OR. EGRTIPREF<>SPACE(3) .OR. EGRFECHA<>CTOD("  -  -  ")
         SELECT 7
         SKIP
         LOOP
      ENDIF
      IF XGEOGRU <> SPACE(3) .AND. XGEOGRU <> GEOGRU
         SELECT 7
         SKIP
         LOOP
      ENDIF
      IF XGEOSUB <> SPACE(3) .AND. XGEOSUB <> GEOSUB
         SELECT 7
         SKIP
         LOOP
      ENDIF
      IF XGEOREN <> SPACE(3) .AND. XGEOREN <> GEOREN
         SELECT 7
         SKIP
         LOOP
      ENDIF
      *** FIN FILTROS

      STORE WLINEA+1 TO WLINEA
      IF WLINEA >=WSALTO
         DO HD0306
         IF WFLAGEXIT
            EXIT
         ENDIF
      ENDIF
      SELECT 7
      @ WLINEA ,01  SAY GEOGRU
      @ WLINEA ,05  SAY GEOSUB
      @ WLINEA ,09  SAY GEOREN
      @ WLINEA ,13  SAY CODIGO
      @ WLINEA ,26  SAY DESCRI1
      @ WLINEA ,67  SAY VALOR PICTURE "######,###.##"
      STORE WTOTAL + VALOR TO WTOTAL
      IF DESCRI2 <> SPACE(40)
         STORE WLINEA+1 TO WLINEA
         IF WLINEA >=WSALTO
            DO HD0306
            IF WFLAGEXIT
               EXIT
            ENDIF
         ENDIF
         @ WLINEA,26 SAY DESCRI2
      ENDIF
      IF DESCRI3 <> SPACE(40)
         STORE WLINEA+1 TO WLINEA
         IF WLINEA >=WSALTO
            DO HD0306
            IF WFLAGEXIT
               EXIT
            ENDIF
         ENDIF
         @ WLINEA,26 SAY DESCRI3
      ENDIF
      IF DESCRI4 <> SPACE(40)
         STORE WLINEA+1 TO WLINEA
         IF WLINEA >=WSALTO
            DO HD0306
            IF WFLAGEXIT
               EXIT
            ENDIF
         ENDIF
         @ WLINEA,26 SAY DESCRI4
      ENDIF
      STORE WLINEA+1 TO WLINEA
      @ WLINEA,00 SAY REPLICATE("-",80)
      SELECT 7
      SKIP
   ENDDO
   STORE WLINEA + 1 TO WLINEA
   IF WLINEA >=WSALTO
      DO HD0306
      IF WFLAGEXIT
         EXIT
      ENDIF
   ENDIF
   @ WLINEA ,38  SAY "TOTAL VALOR REPORTADO:"
   @ WLINEA ,65  SAY WTOTAL PICTURE "####,###,###.##"
   IF WSALIDA = "M"
      STORE "OPRIMA <ENTER> PARA FINALIZAR" TO MES
      DO AVISO WITH MES
   ELSE
      EJECT
      SET DEVI TO SCRE
   ENDIF
ENDDO
return

